const fs = require('fs');
const path = require('path');
const fileSaver = require('file-save');
const {log} = require('../utils');
const TARGET_FILE_NAME = 'a.ts';
const TARGET_TIP = '/* generated by \'bin/methodTemplateGenerate.js\' */';
const FINAL_TIP = '/* generated by \'bin/codeGen/templateGenerate.js\' */';

// utils 源码目录
const src_path = path.join(__dirname, '../../src');

// 读取src目录
const files = fs.readdirSync(src_path);

function refreshFileTip(path) {
    const targetFiles = fs.readdirSync(path);
    targetFiles.forEach(fileArr => {
        if (fileArr.includes(TARGET_FILE_NAME)) {
            const content = fs.readFileSync(path + '/' + TARGET_FILE_NAME, 'utf-8');
            let newContent = '';
            if (content.includes(TARGET_TIP)) {
                newContent = content.replace(TARGET_TIP, FINAL_TIP);
            } else {
                newContent = FINAL_TIP + '\n' + '\n' + content;
            }
            fileSaver(path + '/' + TARGET_FILE_NAME).write(newContent);
            log.success('文件顶部提示刷新成功');
        }
    })
}

files.forEach(item => {
    // 判断是否是文件夹
    const isDir = fs.statSync(path.join(src_path, item)).isDirectory();
    if (isDir && item !== 'utils') {
        refreshFileTip(path.join(src_path, item))
    }
});