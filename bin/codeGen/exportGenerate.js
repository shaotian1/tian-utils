const fs = require('fs');
const path = require('path');
const fileSaver = require('file-save');
const {log} = require('../utils');
const exportTemplates = [];
const PUBLIC_GEN_TIP = '/* generated by \'bin/codeGen/exportGenerate.js\' */\n';

exports.exportGenerate = function () {
    function pushTemplate(dir) {
        exportTemplates.push(`export * from \'./${dir}\';`);
    }
    
    function getTemplate() {
        return PUBLIC_GEN_TIP + '\n' + exportTemplates.join('\n');
    }
    
    // utils 源码目录
    const src_path = path.join(__dirname, '../../src');
    
    // 读取src目录
    const files = fs.readdirSync(src_path);
    
    files.forEach(item => {
        // 判断是否是文件夹
        const isDir = fs.statSync(path.join(src_path, item)).isDirectory();
        if (isDir && item !== 'utils') {
            pushTemplate(item);
        }
    });
    
    fileSaver(path.join(__dirname, '../../src/index.ts'))
        .write(getTemplate())

    log.success('src 入口文件已更新!');
}